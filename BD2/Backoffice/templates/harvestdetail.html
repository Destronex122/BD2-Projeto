{% extends 'base.html' %}

{% block title %}Detalhe da Colheita{% endblock %}

{% block content %}

{% load static %}
<style>
    /* Estilo do modal */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .modal-header h5 {
        margin: 0;
    }

    .close {
        cursor: pointer;
        font-size: 1.5em;
    }
</style>

<div class="editable-area newPadding">
    <h1>Detalhe da Colheita</h1>  

    <div class="dashboard">
        <div class="info-sections">
            <!-- Seção de informações resumidas -->
            <div class="info-card">
                <h2>Produção</h2>
                <div class="info-item">
                    <span class="label">Vinha:</span>
                    <span class="value">Vinha A</span>
                </div>
                <div class="info-item">
                    <span class="label">Casta:</span>
                    <span class="value">Casta X</span>
                </div>
                <div class="info-item">
                    <span class="label">Peso total:</span>
                    <span class="value">10,000 kg</span>
                </div>
                <div class="info-item">
                    <span class="label">Preço por tonelada:</span>
                    <span class="value">€200.00</span>
                </div>
            </div>

            <!-- Seção de previsão e status -->
            <div class="info-card">
                <h2>Status da Colheita</h2>
                <div class="info-item">
                    <span class="label">Data da última pesagem:</span>
                    <span class="value">2024-10-01</span>
                </div>
                <div class="info-item">
                    <span class="label">Período:</span>
                    <span class="value">2024-09-01 a 2024-10-15</span>
                </div>
                <div class="info-item">
                    <span class="label">Previsão do fim:</span>
                    <span class="value">2024-10-15</span>
                </div>
            </div>

            <!-- Notas e Data de Término -->
            <div class="info-card">
                <h2>Notas e Término</h2>
                <div class="info-item">
                    <span class="label">Notas:</span>
                    <span class="value">A colheita está a ir bem, sem pragas até o momento.</span>
                </div>
                <div class="info-item">
                    <span class="label">Data de término:</span>
                    <span class="value">2024-10-10</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Pesagens de Colheita -->
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 class="pesagens-title">Pesagens de Colheita</h2>
        
        <button onclick="openModal()">
            <img src="{% static 'add.png' %}" alt="edit" style="height: 25px; width: 25px;">
        </button>
    </div>
    <div class="pesagens-container" id="pesagensContainer">
        <!-- Pesagens da Vinha A -->
        <div class="pesagem-card">
            <h5>Peso Bruto: 1000.00 kg</h5>
            <p><strong>Peso Líquido:</strong> 950.00 kg</p>
            <p><strong>Data de Pesagem:</strong> 2024-10-01</p>
        </div>
        <div class="pesagem-card">
            <h5>Peso Bruto: 1100.00 kg</h5>
            <p><strong>Peso Líquido:</strong> 1050.00 kg</p>
            <p><strong>Data de Pesagem:</strong> 2024-10-02</p>
        </div>

        <!-- Pesagens da Vinha B -->
        <div class="pesagem-card">
            <h5>Peso Bruto: 1200.00 kg</h5>
            <p><strong>Peso Líquido:</strong> 1150.00 kg</p>
            <p><strong>Data de Pesagem:</strong> 2024-10-03</p>
        </div>
    </div>
</div>

<!-- Modal para adicionar uma nova pesagem -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="addPesagemModalLabel">Nova pesagem</h5>
            <div style="display:flex; justify-content: flex-end;">
                <span data-dismiss="modal" class="close">&times;</span>
            </div>
        </div>
        <div class="modal-body">
            <form id="pesagemForm" onsubmit="addPesagem(event)">
                <div class="form-group">
                    <label for="pesoBruto">Peso bruto (kg)</label>
                    <input type="text" class="form-control" id="pesoBruto" required>
                </div>
                <div class="form-group">
                    <label for="pesoLiquido">Peso líquido (kg)</label>
                    <input type="text" class="form-control" id="pesoLiquido" required>
                </div>
                <div class="form-group">
                    <label for="dataPesagem">Data de pesagem</label>
                    <input type="date" class="form-control" id="dataPesagem" required>
                </div>
                <div style="display:flex; justify-content: flex-end;">
                    <button type="button" class="secondary-button" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="button">Adicionar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Função para abrir o modal
    function openModal() {
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    // Função para fechar o modal
    function closeModal() {
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // Função para adicionar uma nova pesagem
    function addPesagem(event) {
        event.preventDefault(); // Impede o envio do formulário

        const pesoBruto = document.getElementById('pesoBruto').value;
        const pesoLiquido = document.getElementById('pesoLiquido').value;
        const dataPesagem = document.getElementById('dataPesagem').value;

        // Cria o novo card de pesagem
        const newCard = `
            <div class="pesagem-card">
                <h5>Peso Bruto: ${pesoBruto} kg</h5>
                <p><strong>Peso Líquido:</strong> ${pesoLiquido} kg</p>
                <p><strong>Data de Pesagem:</strong> ${dataPesagem}</p>
            </div>
        `;

        // Adiciona o novo card ao container de pesagens
        document.getElementById('pesagensContainer').insertAdjacentHTML('beforeend', newCard);

        // Fecha o modal e limpa o formulário
        closeModal();
        document.getElementById('pesagemForm').reset();
    }
</script>

{% endblock %}
