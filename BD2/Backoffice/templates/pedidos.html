{% extends 'base.html' %}

{% block title %}Pedidos{% endblock %}

{% block content %}

{% load static %}

<style>
    #pedidosTable tbody tr:hover {
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .popup-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .popup-content {
        background: white;
        padding: 20px;
        border-radius: 5px;
        width: 400px;
        max-width: 90%;
    }
</style>

<div class="editable-area newPadding">    
    <div style="display:flex; justify-content: space-between;">
        <h1>Pedidos</h1>
        <div style="justify-self:right; text-align:center;">
            <button type="button" onclick="openAddPedidosModal()">
                <img src="{% static 'add.png' %}" alt="add" style="height: 25px; width: auto;">
            </button>
        </div>
    </div>
    <p>Selecione um pedido para visualizar todos os detalhes.</p>

    <div class="filters" style="margin-bottom: 20px;">
        <form id="filterForm">
            <div style="display: flex; gap: 10px;">
                <div class="form-group">
                    <label for="filterPedido">Pedido:</label>
                    <input type="text" id="filterPedido" class="form-control" placeholder="Ex: Pedido A">
                </div>
                <div class="form-group">
                    <label for="filterDataInicio">Data de início:</label>
                    <input type="date" id="filterDataInicio" class="form-control">
                </div>
                <div class="form-group">
                    <label for="filterDataFim">Data de fim:</label>
                    <input type="date" id="filterDataFim" class="form-control">
                </div>
                <div class="form-group" style="margin-top:24px; width:10%">
                    <button type="button" id="applyFilters" class="button" style="align-self: flex-end;">Aplicar</button>
                </div>
            </div>
        </form>
    </div>

    <table class="table table-bordered" id="pedidosTable">
        <thead>
            <tr>
                <th>Data Início</th>
                <th>Data Fim</th>
                <th>Pedido</th>
                <th>Preço Estimado (€)</th>
                <th>Notas</th>
            </tr>
        </thead>
        <tbody>
            <tr data-pedido-id="1" data-pedido="Pedido A" data-data-inicio="2024-09-01" data-data-fim="2024-10-15" data-preco-estimado="5000.00" data-notas="Pedido urgente.">
                <td>2024-09-01</td>
                <td>2024-10-15</td>
                <td>Pedido A</td>
                <td>5000.00</td>
                <td>Pedido urgente.</td>
            </tr>
            <tr data-pedido-id="2" data-pedido="Pedido B" data-data-inicio="2024-08-15" data-data-fim="2024-10-05" data-preco-estimado="4500.00" data-notas="Pedido com observações.">
                <td>2024-08-15</td>
                <td>2024-10-05</td>
                <td>Pedido B</td>
                <td>4500.00</td>
                <td>Pedido com observações.</td>
            </tr>
        </tbody>
    </table>

    <!-- Modal para Adicionar Pedido -->
    <div class="popup-overlay" id="addPedidosModal">
        <div class="popup-content">
            <div class="popup-header">
                <h5>Adicionar Pedido</h5>
                <span class="modal-close" onclick="closeAddPedidosModal()">&times;</span>
            </div>
            <br>
            <form id="addPedidosForm" onsubmit="addPedido(event)">
                <div class="form-group">
                    <label for="newPedido">Nome do Pedido:</label>
                    <input type="text" id="newPedido" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newDataInicio">Data de Início:</label>
                    <input type="date" id="newDataInicio" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newDataFim">Data de Fim:</label>
                    <input type="date" id="newDataFim" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newPrecoEstimado">Preço Estimado (€):</label>
                    <input type="number" id="newPrecoEstimado" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newNotas">Notas:</label>
                    <textarea id="newNotas" class="form-control" required></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" onclick="closeAddPedidosModal()" class="button">Cancelar</button>
                    <button type="submit" class="button" style="margin-left: 10px;">Adicionar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Função para abrir o modal de adicionar pedido
        function openAddPedidosModal() {
            document.getElementById('addPedidosModal').style.display = 'flex';
        }

        // Função para fechar o modal de adicionar pedido
        function closeAddPedidosModal() {
            document.getElementById('addPedidosModal').style.display = 'none';
        }

        // Função para adicionar um novo pedido na tabela
        function addPedido(event) {
            event.preventDefault();

            // Obtém os valores dos campos do formulário
            const newPedido = document.getElementById('newPedido').value;
            const newDataInicio = document.getElementById('newDataInicio').value;
            const newDataFim = document.getElementById('newDataFim').value;
            const newPrecoEstimado = document.getElementById('newPrecoEstimado').value;
            const newNotas = document.getElementById('newNotas').value;

            // Cria uma nova linha na tabela com os dados do novo pedido
            const newRow = `
                <tr data-pedido="${newPedido}" data-data-inicio="${newDataInicio}" data-data-fim="${newDataFim}" data-preco-estimado="${newPrecoEstimado}" data-notas="${newNotas}">
                    <td>${newDataInicio}</td>
                    <td>${newDataFim}</td>
                    <td>${newPedido}</td>
                    <td>${newPrecoEstimado}</td>
                    <td>${newNotas}</td>
                </tr>
            `;

            // Adiciona a nova linha ao corpo da tabela
            document.querySelector('#pedidosTable tbody').insertAdjacentHTML('beforeend', newRow);

            // Fecha o modal e reseta o formulário
            closeAddPedidosModal();
            document.getElementById('addPedidosForm').reset();
        }

        // Adiciona o redirecionamento para os detalhes do pedido ao clicar na linha da tabela
        const pedidosTable = document.getElementById('pedidosTable');

        pedidosTable.addEventListener('click', function(event) {
            const targetRow = event.target.closest('tr');
            const isHeader = event.target.closest('thead');

            if (targetRow && !isHeader) {
                const pedidoId = targetRow.getAttribute('data-pedido-id');
                window.location.href = `/backoffice/requestdetail/`;
            }
        });
    </script>
</div>

{% endblock %}
