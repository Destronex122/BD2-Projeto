{% extends 'base.html' %}

{% block title %}Envios{% endblock %}

{% block content %}

<!-- templates/simular_entrega.html -->
<div class="newPadding">
    <h1>Entrega de encomendas</h1>
    <br>
    <form method="post">
        {% csrf_token %}
        <label for="numero_encomenda">Número da encomenda:</label>
        <input type="text" id="numero_encomenda" name="numero_encomenda" required>
        {% comment %} <button type="submit">Procurar</button> {% endcomment %}
        <button>Procurar</button>
    </form>
    {% comment %} <form method="post" action="{% url 'simular_entrega' %}"> {% endcomment %}
    <h2>Lista de entregas</h2>
    <table>
        <thead>
            <tr>
                <th>Nº da encomenda</th>
                <th>Endereço</th>
                <th>Código postal</th>
                <th>Cidade</th>
            </tr>
        </thead>
        <tbody>
            {% comment %} {% for delivery in deliveries %} {% endcomment %}
            <tr>
                <td>E123123</td>
                <td>Quinta do Douro</td>
                <td>3000-100</td>
                <td>Porto</td>
            </tr>
            <tr>
                <td>E234432</td>
                <td>Quinta do Dão</td>
                <td>3500-100</td>
                <td>Viseu</td>
            </tr>
            {% comment %} 
            {% empty %}
                <tr>
                    <td colspan="2">Nenhuma entrega pendente.</td>
                </tr>
            {% endfor %} 
            {% endcomment %}
        </tbody>
    </table>

    <script src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_API&libraries=places"></script>

    <br>
    <h2>Trajeto</h2>
    <div id="map"></div>
    <script>
        let map, directionsService, directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -23.55052, lng: -46.633308 }, // Ponto inicial genérico (São Paulo)
                zoom: 12
            });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
        }

        function calcularRota() {
            const origem = document.getElementById("origem").value;
            const destino = document.getElementById("destino").value;

            if (origem && destino) {
                const request = {
                    origin: origem,
                    destination: destino,
                    travelMode: 'DRIVING' // Modo de transporte (DRIVING, BICYCLING, TRANSIT, WALKING)
                };

                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                        directionsRenderer.setDirections(result);
                    } else {
                        alert('Não foi possível encontrar o trajeto: ' + status);
                        }
                    });
            } else {
                alert("Por favor, insira os endereços de partida e destino.");
            }
        }

        // Inicializar o mapa quando a página carregar
        window.onload = initMap;
    </script>
</div>
{% endblock %}
